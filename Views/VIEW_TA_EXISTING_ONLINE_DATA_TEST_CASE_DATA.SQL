/********************************************************************************************************/
/* Помощно view за визуализация на данните от TA таблиците, който подлежат на актуализация */
CREATE OR ALTER VIEW dbo.[VIEW_TA_EXISTING_ONLINE_DATA_TEST_CASE_DATA]
AS
	SELECT [v].[ROW_ID]
		, [v].TA_TYPE
		/* Данни за Титуляра */
		, [v].[CUST_ROW_ID]
		, [c].[UI_CUSTOMER_ID]
		, [c].[UI_EGFN]
		, [c].[NAME]
		, [c].[COMPANY_EFN]
		, [c].[UI_CLIENT_CODE]
		, [c].[UI_NOTES_EXIST]
		, [c].[IS_ZAPOR]
		, [c].[ID_TYPE]
		, [c].[ID_NUMBER]
		, [c].[SERVICE_GROUP_EGFN]
		, [c].[IS_ACTUAL]
		, [c].[PROXY_COUNT]
		, [c].[IS_PROXY]
		/* Данни на Сделката */
		, [v].[DEAL_ROW_ID]
		, [R].[UI_DEAL_NUM]
		, [R].[DB_ACCOUNT]
		, [R].[UI_ACCOUNT]
		, [R].[ZAPOR_SUM]
		, [R].[IBAN]
		, [R].[TAX_UNCOLLECTED_SUM]
		/* Данни за обслужващата пардита за такси */
		, [v].[CORS_ROW_ID]
		, [D].[DEAL_NUM]
		, [D].[CURRENCY]
		, [D].[UI_CORR_ACCOUNT]
		, [D].[TAX_UNCOLLECTED_SUM] AS [TAX_UNCOLLECTED_SUM_CORS]
		/* Данни за пълномощника */
		, [v].[PSPEC_ROW_ID]
		, [v].[PROXY_ROW_ID]
		, [p].[UI_CUSTOMER_ID] AS [UI_CUSTOMER_ID_PROXY]
		, [p].[UI_EGFN] AS [UI_EGFN_PROXY]
		, [p].[NAME] AS [NAME_PROXY]
		, [p].[COMPANY_EFN] AS [COMPANY_EFN_PROXY]
		, [p].[UI_CLIENT_CODE] AS [UI_CLIENT_CODE_PROXY]
		, [p].[UI_NOTES_EXIST] AS [UI_NOTES_EXIST_PROXY]
		, [p].[IS_ZAPOR] AS [IS_ZAPOR_PROXY]
		, [p].[ID_NUMBER] AS [ID_NUMBER_PROXY]
		, [p].[SERVICE_GROUP_EGFN] AS [SERVICE_GROUP_EGFN_PROXY]
		, [p].[IS_ACTUAL] AS [IS_ACTUAL_PROXY]
		, [p].[PROXY_COUNT] AS [PROXY_COUNT_PROXY]
		, [p].[IS_PROXY] AS [PROXY_IS_PROXY]
		/* Данни на Сделката на бенефицента - за някой от тестовите случай за кредитните преводи */
		, [v].[DEAL_BEN_ROW_ID]
		, [DBEN].[UI_DEAL_NUM] AS [UI_DEAL_NUM_BEN]
		, [DBEN].[DB_ACCOUNT] AS [DB_ACCOUNT_BEN]
		, [DBEN].[UI_ACCOUNT] AS [UI_ACCOUNT_BEN]
		, [DBEN].[ZAPOR_SUM] AS [ZAPOR_SUM_BEN]
		, [DBEN].[IBAN] AS [IBAN_BEN]
		, [DBEN].[TAX_UNCOLLECTED_SUM] AS [TAX_UNCOLLECTED_SUM_BEN]
		, [DBEN].[UI_STD_DOG_CODE] AS [UI_STD_DOG_CODE_BEN]
		/* Данни на бенефицента - за някой от тестовите случай за кредитните преводи */
		, [v].[CUST_BEN_ROW_ID]
		, [CUST_BEN].[UI_CUSTOMER_ID] AS [UI_CUSTOMER_ID_BEN]
		, [CUST_BEN].[UI_EGFN] AS [UI_EGFN_BEN]
		, [CUST_BEN].[NAME] AS [NAME_BEN]
		, [CUST_BEN].[COMPANY_EFN] AS [COMPANY_EFN_BEN]
		, [CUST_BEN].[UI_CLIENT_CODE] AS [UI_CLIENT_CODE_BEN]
		/* Данни за таксата */
		, [v].[TAX_CODE] AS [TAX_CODE]
		, [v].[PREF_CODE] AS [PREF_CODE]
	FROM dbo.[VIEW_TA_EXISTING_ONLINE_DATA_CONDITIONS] [v]
	INNER JOIN dbo.[DT015_CUSTOMERS_ACTIONS_TA] [c]
		ON [c].[ROW_ID] = [v].[CUST_ROW_ID]
	INNER JOIN dbo.[RAZPREG_TA] [R]
		ON [R].[ROW_ID] = [v].[DEAL_ROW_ID]
	LEFT JOIN dbo.[DEALS_CORR_TA] [D]
		ON [d].[ROW_ID] = [v].[CORS_ROW_ID]
	LEFT JOIN dbo.[PROXY_SPEC_TA] [S]
		ON [S].[ROW_ID] = [v].PSPEC_ROW_ID
	LEFT JOIN dbo.[DT015_CUSTOMERS_ACTIONS_TA] [p]
		ON [p].[ROW_ID] = [S].[PROXY_CLIENT_ID]
	LEFT JOIN dbo.[RAZPREG_TA] [DBEN]
		ON [DBEN].[ROW_ID] = [v].[DEAL_BEN_ROW_ID]
	LEFT JOIN dbo.[DT015_CUSTOMERS_ACTIONS_TA] [CUST_BEN]
		ON [CUST_BEN].[ROW_ID] = [DBEN].[REF_ID]
GO


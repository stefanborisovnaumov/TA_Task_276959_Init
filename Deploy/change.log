BPB_TA_CASH_PAYMENTS_V2.9.Sql – ver.2.9.3 - 27.07.2022 г., корекция на грешки и подобрения:
-----------------------------------------------------------------------------------------
1. Подобрения
	- Добавена е възможност за филтриране на кореспондиращата сделка, освен по валута и по код 
	 на стандартен договор  (само за случаите когато операцията не е м/у собствени сметки), съответно
	 условията се вземат [RAZPREG_TA] колони:
		- [DEAL_STD_DOG_CODE]
		- [DEAL_CURRENCY_CODE]

BPB_TA_CASH_PAYMENTS_V2.9.Sql - v2.9.1.2 - 27.07.2022 г., корекция на грешки и подобрения:
-----------------------------------------------------------------------------------------
1. Корекции:
	- Заменен е идентификатора на версията ( [DB_TYPE] & [TA_TYPE] ) от 'BETA' на 'AIR' 
		и в изглед [VIEW_TA_EXISTING_ONLINE_DATA_CONDITIONS]
	- Корекция при зареждане на сума в поле [ZAPOR_SUM] да е от първия срещнат запор, а не 
		за всички запори към сделката.
2. Подобрения 
	- Добавени са колоните за код на такса и преференция в изглед [VIEW_TA_EXISTING_ONLINE_DATA_TEST_CASE_DATA]
	- Добавени нов индекси c цел оптимизация за таблици:
		- AGR_TA_EXISTING_ONLINE_DATA_DEALS 
		- [AGR_TA_EXISTING_ONLINE_DATA_CUSTOMERS_COUNT_DEAL_BY_CURRENCY]

BPB_TA_CASH_PAYMENTS_V2.9.Sql - v2.9.1.1 - 26.07.2022 г., корекция на грешки и подобрения:
-----------------------------------------------------------------------------------------
1. Корекции:
	- Заменен е идентификатора на версията ( [DB_TYPE] & [TA_TYPE] ) от 'BETA' на 'AIR' 
		и в таблица [TEST_AUTOMATION_TA_TYPE]

BPB_TA_CASH_PAYMENTS_V2.9.Sql - v2.9.1 - 26.07.2022 г., корекция на грешки и подобрения:
-----------------------------------------------------------------------------------------
1. Корекции:
	- В процедурата за определяне на подходящи сделки, е добавена логика и при 
		стойност 0-ла на параметър [UI_OTHER_ACCOUNT_FOR_TAX] - fix
	- Актуализацията на поле [ZAPOR_SUM] става със сумата на първия срещнат запор.
2. Подобрения 
	- Заменен е идентификатора на версията  ( [DB_TYPE] & [TA_TYPE] ) от 'BETA' на 'AIR' във всички скриптове
	- Инициализацията на данните за клиенти е изнесена в нова процедура [SP_TA_EXISTING_ONLINE_DATA_INIT_CUSTOMERS]
	- Добавена е поддръжка и за Директните Дебити при попълване на данните за кореспондиращата сделка

BPB_TA_CASH_PAYMENTS_V2.9.Sql - v2.9.0 - 21.07.2022 г., корекция на грешки и подобрения:
-----------------------------------------------------------------------------------------
1. Корекции:
	- В процедурата за определяне на подходящи сделки, е добавена логика и при 
		стойност 0-ла на параметър UI_OTHER_ACCOUNT_FOR_TAX
	- Актуализацията на поле ZAPOR_SUM става със сумата на първия срещнат запор.

BPB_TA_CASH_PAYMENTS_V2.8.Sql - v2.8.8 - 30.06.2022 г., корекция на грешки и подобрения:
-----------------------------------------------------------------------------------------
1. Корекции:
	- Отстранена е грешка в процедурата за първоначална инициализация, в следствие на която 
		не се създаваше таблица [AGR_TA_EXISTING_ONLINE_DATA_CUSTOMERS]

BPB_TA_CASH_PAYMENTS_V2.8.Sql - v2.8.7 - 30.06.2022 г., корекция на грешки и подобрения:
-----------------------------------------------------------------------------------------
1. Подобрения:
	- Добавено е създаването на индекси в процедурата за първоначална инициализация 
		за две таблици - във връзка с Issue 13

BPB_TA_CASH_PAYMENTS_V2.8.Sql - v2.8.6 - 28.06.2022 г., корекция на грешки и подобрения:
-----------------------------------------------------------------------------------------
1. Корекции:
	- Корекция във функционалността за актуализация на клиентските данните на бенефициента:
		- данните вече се зачистват преди да се актуализират
		- корекция при определяне на CUSTOMER_ID на бенефициента 

BPB_TA_CASH_PAYMENTS_V2.8.Sql - v2.8.5 - 28.06.2022 г., корекция на грешки и подобрения:
-----------------------------------------------------------------------------------------
1. Корекции:
	- Корекция за условие [LIMIT_ZAPOR] освен флага проверяваме и сумата на блокировката 
		да е > 0 при определяне дали към сделката има активни запори 
2. Подобрения:
	- Добавена е актуализация на клиентските данните за бенефициента

BPB_TA_CASH_PAYMENTS_V2.8.Sql - v2.8.4 - 24.06.2022 г., корекция на грешки и подобрения:
-----------------------------------------------------------------------------------------
1. Корекции:
	- Отстранен е проблем при използване на условия [LIMIT_ZAPOR], при определяне
		дали към дадена сделка има действащ запор, не се проверяваше дали той все още е действащ.

BPB_TA_CASH_PAYMENTS_V2.8.Sql - v2.8.3 - 23.06.2022 г., корекция на грешки и подобрения:
-----------------------------------------------------------------------------------------
1. Подобрения:
	-  Добавена обработка на критерии  'Да няма осчетоводени документи от тип "Нареждане разписка"'
		в рамките на системния ден, при [TYPE_ACTION] = 'CashW' и [RUNNING_ORDER] = 1 - (Issue 6)
2. Корекции:
	- Корекция на процедурата за актуализация на дневните обороти по сметките използвани 
		в даден тестови сценарий - (Issue 8)

BPB_TA_CASH_PAYMENTS_V2.8.Sql - v2.8.2 - 22.06.2022 г., корекция на грешки и подобрения:
-----------------------------------------------------------------------------------------
1. Подобрения:
	- Добавена е нова процедура за актуализация дневните салда по засегнатите партиди към даден тестови случай
		dbo.[SP_TA_EXISTING_ONLINE_DATA_UPDATE_DAY_OPERATIONS_BALANCE] - (Issue 8)

BPB_TA_CASH_PAYMENTS_V2.8.Sql - v2.8.1 - 21.06.2022 г., корекция на грешки и подобрения:
-----------------------------------------------------------------------------------------
1. Корекции:
	- Условоето от [REZPREG_TA].[GS_CARD_PRODUCT] вече се сравнява с [GS_INDIVIDUAL_PROGRAMME].[CARD_PRODUCT] от OnlinDb (Issue 4)
	- Когато стойност на условие [RUNNING_ORDER] e > 1 не се актуализират данните за тестовия случай
		, независимо от стойност в колона [TYPE_ACTION] (Issue 5)

BPB_TA_CASH_PAYMENTS_V2.8.Sql - v2.8.0 - 21.06.2022 г., корекция на грешки и подобрения:
-----------------------------------------------------------------------------------------
1. Корекции:
	- Добавена е нова колона [DAY_OPERATION_BALANCE] в таблици:
		- AGR_TA_EXISTING_ONLINE_DATA_DEALS
		- [AGR_TA_EXISTING_ONLINE_DATA_DEALS_WITH_OTHER_TAX_ACCOUNT]
	- Направена е промяна при прилагане на условие [LIMIT_AVAILABILITY] (както за основната, така и за кореспондиращата партида)
		, да се вземат под внимание дневните движения (Issue 7)


BPB_TA_CASH_PAYMENTS_V2.7.Sql - v2.7.3 - 17.06.2022 г., корекция на грешки и подобрения:
-----------------------------------------------------------------------------------------
1. Корекции:
	- Добавена е актуализация на несъбраната такса за бенефициента в таблица [RAZPREG_TA], колона [TAX_UNCOLLECTED].
	- Условия [IS_UNIQUE] от таблиа [RAZPREG_TA] се взема подвнимание само когато колона [IS_BEN] <> 1 (Issue - 3).

BPB_TA_CASH_PAYMENTS_V2.7.Sql - v2.7.2 - 16.06.2022 г., корекция на грешки и подобрения:
-----------------------------------------------------------------------------------------
1. Корекции:
	- Вече се зачистват данните за бенефициента в таблица RAZPREG_TA (Issue - 1)
	- Флага за валидни документи на клиента се инициализира само когато (Issue - 2):
		- датата на валидност на документа е коректна
		- датата на издаване в > 1970-12-31
		- има въведена страна на издаделя
		- има въведено имe на издателя

BPB_TA_CASH_PAYMENTS_V2.7.Sql - v2.7.1 - 16.06.2022 г., корекция на грешки и подобрения:
-----------------------------------------------------------------------------------------
1. Корекции:
	- Корекция при използване на условия [LIMIT_AVAILABILITY] -> премахване на интервалите
		, преди въведената стойност да се използва като число.
	- Отстранен проблем при формиране на SQL заявката за търсене на подходящи сделки при използване 
		на условие [BETWEEN_OWN_ACCOUNTS] ( превод м/у собствени сметки ).

BPB_TA_CASH_PAYMENTS_V2.7.Sql - v2.7.0 - 15.06.2022 г., корекция на грешки и подобрения:
-----------------------------------------------------------------------------------------
1. Подобрения:
	- Добавена е поддръжка документ 'Кредитен Превод' с възможност за използване на филтър за 
	избор по следните полета:
		- [UI_CURRENCY_CODE] от dbo.[RAZPREG_TA] - за валутата на сметката на получателя
		- [BETWEEN_OWN_ACCOUNTS] от dbo.[PREV_COMMON_TA] - за превод м/у собствени сметки Да/Не

BPB_TA_CASH_PAYMENTS_V2.6.Sql - v2.6.4 - 10.06.2022 г., корекция на грешки и подобрения:
-----------------------------------------------------------------------------------------
1. Корекции:
	- Отстранена грешка при проверка на условия [COLLECT_TAX_FROM_ALL_ACC] - (Issue 9.1)

2. Подобрения:
	- Добавена е поддръжка ( актуализация ) на поле 'Вид на документа за идентификация' - колона [ID_TYPE] 
		от таблица DT015_CUSTOMERS_ACTIONS_TA - (Issue 21)

BPB_TA_CASH_PAYMENTS_V2.6.Sql - v2.6.3 - 09.06.2022 г., корекция на грешки и подобрения:
-----------------------------------------------------------------------------------------
1. Корекции:
	- Променени са процедури за:
		- изичстване на данните - dbo.SP_TA_EXISTING_ONLINE_DATA_FILL_TA_TABLES_CLEAR_CURRENT_DATA
		- актуализация на даните по TA таблиците - dbo.[SP_TA_EXISTING_ONLINE_DATA_FILL_TA_TABLES]
		- търсена на подходяща сделка - dbo.[SP_TA_EXISTING_ONLINE_DATA_FILL_TA_TABLES_PREPARE_CONDITIONS]
	 във връзка с тестовете на свързаните документи от тип 'вносни бележки', така че тя да се 
	 изпълнява само за първия документ ([TYPE_ACTION] = 'CashPayment' и [RUNNING_ORDER] = 1 към Issue 15)

BPB_TA_CASH_PAYMENTS_V2.6.Sql - v2.6.2 - 08.06.2022 г., корекция на грешки и подобрения:
-----------------------------------------------------------------------------------------
1. Подобрения:	
	- Добавен е нов флаг на ниво клиент за наличие на активен запор по някоя от сметките на клиента
		, за обслужване на поле [IS_ZAPOR] от таблица [DT015_CUSTOMERS_ACTIONS] към (Issue 4)

	- Добавен е нов флаг на ниво клиент [HAS_UNCOLLECTED_TAX_CONNECTED_TO_ALL_ACC] за наличие на 
		несъбрана такса, която подлежи на събира от всички сметки на клиента - за обслужване на 
		условие [DT015_CUSTOMERS_ACTIONS].[COLLECT_TAX_FROM_ALL_ACC] към (Issue 9.1)

2. Остранена грешка при определяне дали към сметката има осчетоводена вносна бележка в 
	текущия системен ден.

BPB_TA_CASH_PAYMENTS_V2.6.Sql - v2.6.1 - 07.06.2022 г., корекция на грешки и подобрения:
-----------------------------------------------------------------------------------------
1. Корекции:
	- Отсранен е проблема при използването на критерии [UI_BANK_RECEIVABLES] - (Issue 19)

2. Подобрения:	
	- Добавена е възможност за фитриране на сделките по условия да нямат пуснати към тях вносно блежки 
		([TYPE_ACTION] = 'CashPayment' и [RUNNING_ORDER] = 1 към Issue 15)

BPB_TA_CASH_PAYMENTS_V2.6.Sql - v2.6.0 - 07.06.2022 г., корекция на грешки и подобрения:
-----------------------------------------------------------------------------------------
1. Корекции:
	- Отсранен е проблема за филтриране по критерии [UI_NM342_CODE] - (Issue 17)
		, освен за този критерии е променена функционалността и за:
			- [GS_PROGRAMME_CODE]
			- [GS_CARD_PRODUCT]

	- Отсранен е проблема за филтриране по критерии [EGFN_TYPE] - (Issue 18)

BPB_TA_CASH_PAYMENTS_V2.5.Sql - v2.5.1 - 31.05.2022 г., корекция на грешки и подобрения:
-----------------------------------------------------------------------------------------
1. Подобрения:
	- Добавена е поддръжка на нов критерий ( [RAZPREG_TA].[INT_COND_STDCONTRACT] ) за избор на индивидуални разплащателни сделки
		, разкрити с опеределен номер на стандартен договор. 
	- Във връзка с новия критерин е промен начина по който формиране на заяваката за търсена на подходящи сделки:
		- ако флага UI_INDIVIDUAL_DEAL е равен на '0':
			- търсим сделки за който [RAZPREG].[STD_DOG_CODE] да е = на [RAZPREG_TA].[UI_STD_DOG_CODE] (от условията)
		- ако флага UI_INDIVIDUAL_DEAL е равен на '1':
			- търсим сделки на който им е вдигнат флага за индивидуални сделки (16 бит)
			- и ако [UI_STD_DOG_CODE] > 0 -> [RAZPREG].[STD_DOG_CODE] да е = на [RAZPREG_TA].[UI_STD_DOG_CODE] (от условията)
			- и ако [INT_COND_STDCONTRACT] -> [RAZPREG].[INT_COND_STDCONTRACT] да е = на [RAZPREG_TA].[INT_COND_STDCONTRACT] (от условията)

2. Корекции:
	- Коригиран е начина за подбор на индивидуални сделки, като вече се вземат впредвид стойностите 0-ла за условия:
		- [UI_STD_DOG_CODE]
		- [INT_COND_STDCONTRACT]
	- Коригирана е процедурата за пресмятана на TAX_UNCOLLECTED


BPB_TA_CASH_PAYMENTS_V2.4.Sql v2.4.3 - 27.05.2022 г., корекция на грешки и подобрения:
-----------------------------------------------------------------------------------------
1. Корекция на грешки:
	- Отстранен е проблема, възникващ при едновременно избрани условия за:
		- индивидуална сделка ( [UI_INDIVIDUAL_DEAL] = 1 ) 
		- и номер на стандартен договор ( [UI_STD_DOG_CODE] = 1234 )
	- Отстранен е проблема, който възниква когато стойността на условие [UI_RAZPOREDITEL] е = -1
	- При изчисляване сумата на несъбраните такси [TAX_UNCOLLECTED_SUM], взема в предвид валутата на всяка -> Issue 9
	една отделна такса, като се използва превалутиране към валутата на партидата за такси.
	- (v2.4.2) Отсранена е грешка в процедурата за зареждане на данни в таблицата за сделки [RAZPREG_TA], когато по нея има непратени такси
	- (v2.4.2) Отсранена е грешка в процедурата за зареждане сумата на нептатената такса към сметка
	- (v2.4.2) Процедурата за зачистване на данни, вместо празен низ '' инициализират клиентските данни с '0' за следните колони
	(до момента това се правеше само за Proxy-тата):
		- [UI_CUSTOMER_ID]
		- [UI_EGFN]
		- [COMPANY_EFN]
		- [UI_CLIENT_CODE]
		- [ID_NUMBER]
		- [SERVICE_GROUP_EGFN]
	- (v2.4.3) Отстранен използване на критерии UI_JOINT_TYPE (за клиенти и сделки) -> Issue 11
	- (v2.4.3) Отстранен използване на критерии UI_JOINT_TYPE -> Issue 12
	- (v2.4.3) Отстранен проблем при определяне на флаг [UI_NOTES_EXIST] -> Issue 13
	- (v2.4.3) Корогирано е формирането на поле [UI_ACCOUNT] - в предния вариант се одрязваше контролното число

2. Подобрения:
	- Добавена е нова съхранена процедура която връща (от OnlieDB) общата сума 
	на несъбрани такси по дадена сметка
	
BPB_TA_CASH_PAYMENTS_V2.3.Sql v2.3 - 25.05.2022 г., корекция на грешки и подобрения:
-----------------------------------------------------------------------------------------
1. Корекция на грешки:
	- В таблица dbo.[DEALS_CORR_TA] вече не се актулизира колона [CURRENCY], използва се само като условие
	- В таблица dbo.[DT015_CUSTOMERS_ACTIONS_TA], по колони се записва '0' вместо '':
		- [UI_CUSTOMER_ID]
		- [UI_EGFN]
		- [COMPANY_EFN]
		- [UI_CLIENT_CODE]
		- [ID_NUMBER]
		- [SERVICE_GROUP_EGFN]
	- Остранена е грешка при определяне на колона [IS_ZAPOR] в таблица dbo.[DT015_CUSTOMERS_ACTIONS_TA]


BPB_TA_CASH_PAYMENTS_V2.2.Sql v2.2 - 19.05.2022 г., корекция на грешки и подобрения:
-----------------------------------------------------------------------------------------
1. Корекция на грешки:
    - Крекция на процедурата за извличане на данните за кореспондиращите сметки, вече данни се извличат от OnlineDB, за:
        - Номера и тъп на сделка за партидата на кореспонденицята
        - Инициали на валута
        - Блокирана сума 
        - Разполагаемост
        - Сума на несъбраните такси

    - Направена е корекция при изчисляване сумата на запора - вече се вземат в предвид закритите блокировки.

    - Актуализация на поле UI_ACCOUNT от таблица dbo.[RAZPREG_TA], направена е корекция сметката да се връща с интервали.

    - Корекция при формиране SQL заявката по условие:
        - LIMIT_AVAILABILITY - подръжка на сравниения от вида '> X', '< X' и '= X'
            , както за основната партида, така и за тази на кореспонденцията.

2. Подобрения:
    - Премахнати са референциите към колона LIMIT_TAX_UNCOLLECTED към таблица dbo.[DEALS_CORR_TA] от всички скриптове.

    - Добавена е нова таблица dbo.[AGR_TA_EXISTING_ONLINE_DATA_FILL_TA_TABLES_SQL_CONDITIONS] в която има възможност да се съхраняват SQL условия
        от който в последствие се генерира SQL заявката за намиране на подходяща сделка.
